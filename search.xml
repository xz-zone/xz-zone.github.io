<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>情报挖掘技巧</title>
      <link href="/2019/01/15/sort-cutting-edge/"/>
      <url>/2019/01/15/sort-cutting-edge/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文整理并总结了网盘情报挖掘技巧。</p><h2 id="中文核心敏感关键词"><a href="#中文核心敏感关键词" class="headerlink" title="中文核心敏感关键词"></a>中文核心敏感关键词</h2><p>邮件、附件、合作、推广、（年份）、身份证、地址、工程、市场、游戏、文件、运营、市场、技术、ftp、备份、投标、通讯录、花名册、内部、员工、报表、尽调、合同、扫描件、协议、图纸、参数、招标、资质、证件、备案、审核、商家、点击、暗访、入职、信息、资料、预案、文化部（针对游戏厂商）、团队、施工、装修、我的。  </p><h2 id="英文核心敏感关键词"><a href="#英文核心敏感关键词" class="headerlink" title="英文核心敏感关键词"></a>英文核心敏感关键词</h2><p>wechat、qqfilerev、filerev、QQ_images、tencentfiles、backup、work、contact、sms、message、report、gongzuo、gz、info、pc、face、id、pv。  </p><h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><p>使用网盘搜索引擎or自己的网盘爬虫，进行结果搜索。使用企业名+关键词进行排查。以上关键词均为百万级数据占用比例较高的关键词，基本为敏感内容，其中对于文件分级为C1~C4四个等级，后面会详细讲。  </p><h2 id="排查技巧"><a href="#排查技巧" class="headerlink" title="排查技巧"></a>排查技巧</h2><p>1、企业名可以使用中文或者英文、拼音或者缩略词，比如：阿里巴巴——alibaba、阿里；支付宝——alipay、zfb；腾讯——qq、tencent、tx。<br>2、优先排查文件夹类型、后者是rar、zip；如果为合同、协议等文件，多数为pdf文件，由于此类是需要签字盖章才能算为敏感文件，多数是”扫描件“，所以可以结合两个关键词进行搜索，比如说”合同+扫描件“；如果为报表等信息，多数为xls、xlsx文件，学会根据搜索词判断文件类型，减少排查范围。<br>3、优先排查分享时间最近的文件。<br>4、合同类文件需要注意合同时效，其中内部合同多数会有标注为内部文件，或者是有保密协议。<br>5、搜索词可以进行多个组合变换，或者改变顺序。<br>6、关键词可以像第1条一样，进行变换缩略，比如说：身份证——sfz。<br>7、不要放过图片信息，很多敏感信息可能存在照片中。<br>8、使用企业旗下的业务名称+关键词进行排查，更为准确。<br>9、对于一些新业务、冷门业务，可以直接排除掉。<br>10、在使用的过程中，应注意遵守SRC的保密协议，勿做擅自备份。 </p><h2 id="情报提交格式"><a href="#情报提交格式" class="headerlink" title="情报提交格式"></a>情报提交格式</h2><p>需写明泄露源URL，即网盘链接。以及上传该信息的百度用户名（如果有就写）。注明包含了什么并截图证明，附带搜索关键词及思路，方便企业进行相关自查（如果想留底用来自己提交，可以不写），类型选择威胁情报，一般为业务情报，敏感信息泄露或者内部文件泄露。如果无威胁情报接收，可以在漏洞里面选择信息泄露。必须说明该泄露可能造成的危害，并且尽可能的标注里面的敏感点。</p>]]></content>
      
      
      <categories>
          
          <category> 情报 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>看我是如何利用验证码把服务器弄崩溃</title>
      <link href="/2018/07/17/sort-code-audit/"/>
      <url>/2018/07/17/sort-code-audit/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>程序下载地址：<a href="https://pan.baidu.com/s/1pI4rPXI3Fu_AGkea-0VqBQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1pI4rPXI3Fu_AGkea-0VqBQ</a><br>版本：V5.1.18030300<br>简介：iWebShop基于iweb SI框架开发，在获得iweb SI技术平台库支持的条件下，iWebShop可以轻松满足用户量级百万至千万级的大型电子商务网站的性能要求。</p><h2 id="程序安装到复现"><a href="#程序安装到复现" class="headerlink" title="程序安装到复现"></a>程序安装到复现</h2><p>1.第一步安装系统<br><img src="1.png" alt="图1"><br>2.第二步安装结束选择前台<br><img src="1.png" alt="图2"><br>3.第四步到注册页面<br><img src="3.png" alt="图3"><br>4.F12查看地址，然后提取URL地址<br><img src="4.png" alt="图4"><br>5.在URL加上w=100&amp;h=100发现这里可以控制的<br>URL：<a href="http://192.168.60.135/index.php?controller=simple&amp;action=getCaptcha&amp;w=100&amp;h=100" target="_blank" rel="noopener">http://192.168.60.135/index.php?controller=simple&amp;action=getCaptcha&amp;w=100&amp;h=100</a><br><img src="5.png" alt="图5"></p><h2 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h2><p>漏洞所在文件：<code>\lib\web\controller\controller_class.php(在图像验证码)</code><br>漏洞文件代码：(只贴上相关代码)<br><img src="6.png" alt="图6"><br>首先我们看第51行，<code>$this-&gt;layout = &#39;&#39;;</code>清空布局，然后我们在看第54-57行这里代表取<code>get</code>参数，3元运算符，这里就不解释了，我们在看看第60行。<code>$ValidateObj = new Captcha();</code>，我们看看这个函数在哪里。<br>路径：<code>\lib\core\util\captcha_class.php</code><br><img src="7.png" alt="图7"><br>我们看看第93行<code>$ini = microtime(true);</code>，获取毫秒时间戳，在看看第96行<code>$this-&gt;ImageAllocate();</code>，这里调用当前方法。<br><img src="8.png" alt="图8"><br>第131行判断<code>if (!empty($this-&gt;im))</code>，如果判断<code>$this-&gt;im</code>不为空，<code>imagedestroy($this-&gt;im);</code>那么就销毁图像，第136行，<code>imagecreatetruecolor</code>，创建真彩图像资源，第139行，<code>imagecolorallocate</code>，给图像分配颜色，第144行，<code>imagefilledrectangle</code>，画一矩形并填充，那么现在已知道它这里是创建个图层。<br>那么我们回到第二张图片，第99行，<code>$text = $this-&gt;GetCaptchaText();</code>，这里又走进这个方法，看下表面的意思大概是在图层写上文字。<br><img src="9.png" alt="图9"><br>我们看第168行<code>$text = $this-&gt;GetRandomCaptchaText();</code>，在第176行，我们看看第178行判断<code>if (empty($length))</code>长度是否为空，如果为空那么进入第180区间，随机取长度，这里只是产生随机数，我们在回到图二。<br>第101行，<code>$this-&gt;WriteText($text, $fontcfg);</code>，这里好像是给图像染上文字。<br><img src="10.png" alt="图10"><br>这里看到判断<code>if (empty($fontcfg))</code>，是否为空如果不为空那么则不走进此区间。我们在看看第216行，<code>$fontfile = dirname(__FILE__).DIRECTORY_SEPARATOR.$fontcfg[&#39;font&#39;];</code>，获取当前字体路径。<br>第219行到220行<code>$lettersMissing = $this-&gt;maxWordLength-strlen($text);</code>，字体长度，<code>$fontSizefactor = 1+($lettersMissing*0.09);</code>，字体大小，第227行到229行，<code>$x = 20*$this-&gt;scale;</code>，代表图像的x轴，<code>$y = round(($this-&gt;height*27/40)*$this-&gt;scale);，代表图像的y轴，$length = strlen($text);</code>，统计字体长度。<code>for ($i=0; $i&lt;$length; $i++)</code>，<code>for</code>循环，第232行到第234行，<code>rand</code>取随机数，第235行，<code>substr</code>字符串切割。<code>imagettftext</code>，输出字符串到图层。回到第二张图片。<br><img src="11.png" alt="图11"><br>在的256行，<code>$xp = $this-&gt;scale*$this-&gt;Xperiod*rand(1,3);</code>，生成x轴，第260行，<code>imagecopy</code>，拷贝图像，第267行类似，生成y轴，拷贝图像，这里代表过滤图像，回到第二张图片。<br>第105行<code>if ($this-&gt;blur &amp;&amp; function_exists(&#39;imagefilter&#39;))</code>，判断<code>$this-&gt;blur</code>并且判断<code>function_exists(&#39;imagefilter&#39;)</code>，是否有这个方法，如果没有进入第107行，<code>imagefilter($this-&gt;im, IMG_FILTER_GAUSSIAN_BLUR);</code>，对图像使用过滤器，第109行<code>$this-&gt;ReduceImage();</code>。<br><img src="12.png" alt="图12"><br>第281行，<code>$imResampled = imagecreatetruecolor($this-&gt;width, $this-&gt;height);</code>，创建真彩图像资源，<code>imagecopyresampled</code>，图像处理，<code>imagedestroy</code>，销毁图像，回到第二张图片。<br>第113行，<code>imagestring</code>，设置字体大小。<br><img src="13.png" alt="图13"><br>第296行，<code>if ($this-&gt;imageFormat == &#39;png&#39; &amp;&amp; function_exists(&#39;imagepng&#39;))</code>，判断默认设置是不是png图像，并且判断<code>function_exists(&#39;imagepng&#39;)</code>，<code>imagepng</code>以png格式将图像输出到浏览器，<code>&#39;imagejpeg&#39;</code>以jpeg格式将图像输出到浏览器，然后我们在看看第311行，销毁<code>imagedestroy</code>。</p>]]></content>
      
      
      <categories>
          
          <category> 代码审计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP代码审计 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
